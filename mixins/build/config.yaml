# yaml-language-server: $schema=./config.schema.json
entries:
  - destination: manifests/platform/services/observability/alloy/rules
    mixins:
      - name: k8s-mixin-rules
        type: prometheus-rule
        mixin_import: github.com/kubernetes-monitoring/kubernetes-mixin/mixin.libsonnet
        groups_key: prometheusRules
      - name: k8s-mixin-alerts
        type: prometheus-rule
        mixin_import: github.com/kubernetes-monitoring/kubernetes-mixin/mixin.libsonnet
        groups_key: prometheusAlerts
      - name: node-mixin-rules
        type: prometheus-rule
        mixin_import: github.com/prometheus/node_exporter/docs/node-mixin/mixin.libsonnet
        config_import: mixins/build/node-mixin/config.libsonnet
        groups_key: prometheusRules
      - name: node-mixin-alerts
        type: prometheus-rule
        mixin_import: github.com/prometheus/node_exporter/docs/node-mixin/mixin.libsonnet
        config_import: mixins/build/node-mixin/config.libsonnet
        groups_key: prometheusAlerts

  - destination: manifests/platform/base/secrets/cert-manager/rules
    mixins:
      - name: cert-manager-mixin-rules
        type: prometheus-rule
        mixin_import: github.com/imusmanmalik/cert-manager-mixin/mixin.libsonnet
        config_import: mixins/build/cert-manager-mixin/config.libsonnet
        groups_key: prometheusRules
      - name: cert-manager-mixin-alerts
        type: prometheus-rule
        mixin_import: github.com/imusmanmalik/cert-manager-mixin/mixin.libsonnet
        config_import: mixins/build/cert-manager-mixin/config.libsonnet
        groups_key: prometheusAlerts

  - destination: manifests/platform/services/observability/mimir/rules
    mixins:
      - name: mimir-mixin-rules
        type: prometheus-rule
        mixin_import: github.com/grafana/mimir/operations/mimir-mixin/mixin.libsonnet
        groups_key: prometheusRules
      - name: mimir-mixin-alerts
        type: prometheus-rule
        mixin_import: github.com/grafana/mimir/operations/mimir-mixin/mixin.libsonnet
        groups_key: prometheusAlerts

  - destination: manifests/platform/services/data-platform/strimzi-kafka/metrics/rules
    mixins:
      - name: strimzi-kafka-mixin-rules
        type: yaml
        source_glob: mixins/vendor/metrics/prometheus-install/prometheus-rules/*.yaml
        exclude_files:
          - prometheus-kafka-bridge-rules.yaml
          - prometheus-kafka-connect-rules.yaml
          - prometheus-mirrormaker2-rules.yaml

  - destination: manifests/platform/services/data-platform/strimzi-kafka/metrics/configmaps
    mixins:
      - name: kafka-metrics
        type: jsonnet
        entrypoint: mixins/build/strimzi-kafka/kafka-metrics-configmap.jsonnet

  - destination: manifests/platform/services/data-platform/strimzi-kafka/metrics/podmonitors
    mixins:
      - name: strimzi-kafka-podmonitors
        type: yaml
        source_glob: mixins/vendor/github.com/strimzi/strimzi-kafka-operator/examples/metrics/prometheus-install/pod-monitors/*.yaml
        exclude_files:
          - bridge-metrics.yaml
